<!DOCTYPE html>
<html lang="et">
<head>
<meta charset="UTF-8">
<title>Oktoobri Kutse</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
body{
  background-size:cover;
  background-position:center;
  background-attachment:fixed;
}
.overlay{
  background:rgba(255,255,255,0.85);
  min-height:100vh;
}
.progress-bar{
  color:#fff;
  font-weight:bold;
  text-shadow:-1px -1px 0 #000,1px -1px 0 #000,-1px 1px 0 #000,1px 1px 0 #000;
}
table th,table td{text-align:center;}
</style>
</head>

<body>
<div class="overlay">
<div class="container py-4">

<!-- PEALKIRI -->
<div class="card shadow mb-3 text-center">
<div class="card-body">
<h4>ðŸ‡ªðŸ‡ª Oktoobri Kutse â†’ <strong>PÃ¤evi reservini</strong></h4>
<p id="clock" class="fw-bold"></p>
</div>
</div>

<!-- TABID -->
<ul class="nav nav-tabs mb-3">
<li class="nav-item">
<button class="nav-link active" data-bs-toggle="tab" data-bs-target="#progressTab">ðŸ“ˆ Edenemine</button>
</li>
<li class="nav-item">
<button class="nav-link" data-bs-toggle="tab" data-bs-target="#todayTab">ðŸ§¹ TÃ¤na</button>
</li>
<li class="nav-item">
<button class="nav-link" data-bs-toggle="tab" data-bs-target="#listTab">ðŸ§¹ Toa korrapidaja list</button>
</li>
</ul>

<div class="tab-content">

<!-- EDENEMINE -->
<div class="tab-pane fade show active" id="progressTab">
<div class="card shadow mb-4">
<div class="card-body">

<label>Kogu periood</label>
<input id="totalDays" class="form-control mb-2" readonly>

<label>Tehtud</label>
<input id="doneDays" class="form-control mb-2" readonly>

<label>JÃ¤Ã¤nud</label>
<input id="leftDays" class="form-control mb-2" readonly>

<label>LÃ¤bitud aeg</label>
<input id="elapsedTime" class="form-control mb-2" readonly>

<label>Progress</label>
<div class="progress mb-3" style="height:30px">
<div id="progressBar" class="progress-bar progress-bar-striped progress-bar-animated">0%</div>
</div>

<label>JÃ¤rgmine eesmÃ¤rk</label>
<input id="goal" class="form-control" readonly>

</div>
</div>

<div class="card shadow mb-4 text-center">
<div class="card-body">
<h5>ðŸ˜‚ TÃ¤nane sÃµdurinali</h5>
<p id="soldierJoke" class="fw-semibold"></p>
<small class="text-muted">Uueneb iga pÃ¤ev kell 06:00</small>
</div>
</div>
</div>

<!-- TÃ„NA -->
<div class="tab-pane fade" id="todayTab">
<div class="card shadow text-center">
<div class="card-body">
<h5>ðŸ§¹ TÃ¤nased korrapidajad</h5>
<p id="todayDate" class="fw-bold"></p>
<p><strong>Parem tuba:</strong> <span id="todayRight"></span></p>
<p><strong>Vasak tuba:</strong> <span id="todayLeft"></span></p>
</div>
</div>
</div>

<!-- KORRAPIDAJA LIST -->
<div class="tab-pane fade" id="listTab">
<div class="card shadow">
<div class="card-body">

<div class="accordion" id="roomsAccordion">
<!-- siia ehitatakse automaatselt -->
</div>

</div>
</div>
</div>

</div>
</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
/* ===================== KONFIG ===================== */
const CONFIG={
  progress:{start:new Date(2025,9,13),end:new Date(2026,5,12)},
  duty:{start:new Date(2026,0,6),end:new Date(2026,5,12)},
  rooms:{
    parem:{
      label:"Parema toa korrapidaja",
      names:["SUDER","PISNENKO","TAMMUS","KASPAR PLANS","VIISPERT","NURMETALO","KAAREL PLANS","MARK","KRISTI"]
    },
    vasak:{
      label:"Vasaku toa korrapidaja",
      names:["KOSEMAA","KUUSEORG","LUMISTE","MÃœÃœR","PAASKIVI","PEETRIS","PINT","TAMME","JAKOBSON"]
    }
  },
  jokes:[
    "SÃµdur ei maga â€“ ta ootab suletud silmadega.",
    "Ajateenistuses Ãµpid, et 'kohe' ei tÃ¤henda kunagi.",
    "Rivis on alati kÃ¼lmem.",
    "Kui kÃ¤stakse puhata, tuleb uus kÃ¤sk."
  ],
  backgrounds:[
    "https://images.unsplash.com/photo-1605727216801-e27ce1d0cc28",
    "https://images.unsplash.com/photo-1598387993211-5c3b8b3bdbf5",
    "https://images.unsplash.com/photo-1520975916090-3105956dac38"
  ]
};

/* ===================== ABI ===================== */
const dayMs=1000*60*60*24;
const nowEE=()=>new Date(new Date().toLocaleString("en-US",{timeZone:"Europe/Tallinn"}));
const daysBetween=(a,b)=>Math.floor((b-a)/dayMs);

function elapsed(start,now){
  let m=0,t=new Date(start);
  while(new Date(t.getFullYear(),t.getMonth()+1,t.getDate())<=now){
    t.setMonth(t.getMonth()+1);m++;
  }
  const d=Math.floor((now-t)/dayMs);
  const h=Math.floor(((now-t)%dayMs)/(1000*60*60));
  return `${m} kuud, ${d} pÃ¤eva, ${h} tundi`;
}

/* ===================== UPDATE ===================== */
function updateAll(){
const now=nowEE();
clock.innerText=now.toLocaleDateString("et-EE")+" "+now.toLocaleTimeString("et-EE");

const total=daysBetween(CONFIG.progress.start,CONFIG.progress.end);
const done=Math.max(0,daysBetween(CONFIG.progress.start,now));
const left=total-done+1;

totalDays.value=total+" pÃ¤eva";
doneDays.value=done+" pÃ¤eva";
leftDays.value=left+" pÃ¤eva";
elapsedTime.value=elapsed(CONFIG.progress.start,now);

const pct=Math.min(100,(done/total*100).toFixed(1));
progressBar.style.width=pct+"%";
progressBar.innerText=pct+"%";

goal.value=
done<total*0.5?`50%: ${Math.round(total*0.5-done)} pÃ¤eva`:
done<total*0.75?`75%: ${Math.round(total*0.75-done)} pÃ¤eva`:
done<total?`100%: ${total-done} pÃ¤eva`:"VALMIS";

const idx=daysBetween(CONFIG.duty.start,now);
todayDate.innerText=now.toLocaleDateString("et-EE");
todayRight.innerText=CONFIG.rooms.parem.names[idx%CONFIG.rooms.parem.names.length];
todayLeft.innerText=CONFIG.rooms.vasak.names[idx%CONFIG.rooms.vasak.names.length];

let jokeDay=new Date(now);
if(now.getHours()<6) jokeDay.setDate(jokeDay.getDate()-1);
soldierJoke.innerText=CONFIG.jokes[daysBetween(new Date(2025,0,1),jokeDay)%CONFIG.jokes.length];

document.body.style.backgroundImage=
`url(${CONFIG.backgrounds[daysBetween(new Date(2025,0,1),now)%CONFIG.backgrounds.length]})`;
}

/* ===================== ACCORDION LIST ===================== */
function buildLists(){
let html="",iAcc=0;
for(const key in CONFIG.rooms){
  const room=CONFIG.rooms[key];
  html+=`
  <div class="accordion-item">
    <h2 class="accordion-header">
      <button class="accordion-button ${iAcc?`collapsed`:``}" data-bs-toggle="collapse"
        data-bs-target="#room${iAcc}">
        ${room.label}
      </button>
    </h2>
    <div id="room${iAcc}" class="accordion-collapse collapse ${iAcc?``:`show`}"
      data-bs-parent="#roomsAccordion">
      <div class="accordion-body">
        <table class="table table-bordered table-striped">
        <thead><tr><th>KuupÃ¤ev</th><th>Nimi</th></tr></thead><tbody>`;
  let i=0;
  for(let d=new Date(CONFIG.duty.start);d<=CONFIG.duty.end;d.setDate(d.getDate()+1)){
    html+=`<tr><td>${d.toLocaleDateString("et-EE")}</td><td>${room.names[i%room.names.length]}</td></tr>`;
    i++;
  }
  html+=`</tbody></table>
      </div>
    </div>
  </div>`;
  iAcc++;
}
roomsAccordion.innerHTML=html;
}

buildLists();
updateAll();
setInterval(updateAll,1000);
</script>

</body>
</html>
