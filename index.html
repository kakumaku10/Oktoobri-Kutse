<!DOCTYPE html>
<html lang="et">
<head>
<meta charset="UTF-8">
<title>Oktoobri Kutse</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
body{background:#f5f5f5;}
.progress-bar{
 color:#fff;font-weight:bold;
 text-shadow:-1px -1px 0 #000,1px -1px 0 #000,-1px 1px 0 #000,1px 1px 0 #000;
}
</style>
</head>

<body>
<div class="container py-4">

<div class="card shadow text-center mb-3">
<div class="card-body">
<h4>ðŸ‡ªðŸ‡ª Oktoobri Kutse â†’ <strong>PÃ¤evi reservini</strong></h4>
<p id="clock" class="fw-bold"></p>
</div>
</div>

<ul class="nav nav-tabs mb-3">
<li class="nav-item"><button class="nav-link active" data-bs-toggle="tab" data-bs-target="#progressTab">ðŸ“ˆ Edenemine</button></li>
<li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#todayTab">ðŸ§¹ TÃ¤na</button></li>
</ul>

<div class="tab-content">

<div class="tab-pane fade show active" id="progressTab">
<div class="card shadow">
<div class="card-body">

<input id="totalDays" class="form-control mb-2" readonly>
<input id="doneDays" class="form-control mb-2" readonly>
<input id="leftDays" class="form-control mb-2" readonly>

<div class="progress mb-3" style="height:30px">
<div id="progressBar" class="progress-bar progress-bar-striped progress-bar-animated">0%</div>
</div>

<input id="goal" class="form-control" readonly>

</div>
</div>
</div>

<div class="tab-pane fade" id="todayTab">

<div class="card shadow text-center mb-3">
<div class="card-body">
<h5>ðŸ§¹ TÃ¤nased korrapidajad</h5>
<p id="todayDate" class="fw-bold"></p>
<p>Parem tuba: <span id="todayRight"></span></p>
<p>Vasak tuba: <span id="todayLeft"></span></p>
</div>
</div>

<div class="card shadow text-center">
<div class="card-body">
<h5>ðŸ§½ Ala koristajad tÃ¤na</h5>
<p id="areaCleaners" class="fw-bold"></p>
</div>
</div>

</div>
</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
/* ---------- KUUPÃ„EVAD ---------- */
const START_DATE=new Date(2025,9,13);
const END_DATE=new Date(2026,5,12);
const DUTY_START=new Date(2026,0,6);

/* ---------- NIMED ---------- */
const RIGHT=["KOSEMAA","KUUSEORG","LUMISTE","MÃœÃœR","PAASKIVI","PEETRIS","PINT","TAMME","JAKOBSON"];
const LEFT=["ARU","SUDER","PISNENKO","TAMMUS","KASPAR PLANS","VIISPERT","NURMETALO","KAAREL PLANS","MARK","KRISTI"];

const ALL=[...RIGHT,...LEFT];
const PRIORITY=["TAMME","PINT","KOSEMAA","KUUSEORG"];

const DAY=86400000;

/* ---------- TALLINN AEG ---------- */
function nowTallinn(){
 return new Date(new Date().toLocaleString("en-US",{timeZone:"Europe/Tallinn"}));
}
function day(d){return new Date(d.getFullYear(),d.getMonth(),d.getDate());}
function diff(a,b){return Math.floor((b-a)/DAY);}

/* ---------- PÃ„EVAD ---------- */
function calcDays(){
 const today=day(nowTallinn());
 const start=day(START_DATE);
 const end=day(END_DATE);

 const total=diff(start,end)+1;
 const done=Math.max(0,diff(start,today));
 const left=Math.max(0,diff(today,end)+1);

 return {total,done,left,today};
}

/* ---------- KORRAPIDAJA ---------- */
function roomDuty(today,list){
 const i=diff(day(DUTY_START),today);
 return list[(i%list.length+list.length)%list.length];
}

/* ---------- SEED RANDOM ---------- */
function rand(seed){
 let x=Math.sin(seed)*10000;
 return x-Math.floor(x);
}

/* ---------- ALA KORISTAJAD ---------- */
function areaCleanersFor(date){
 const start=day(START_DATE);
 let prev=[];
 let result=[];

 for(let d=new Date(start);d<=date;d.setDate(d.getDate()+1)){

  const seed=diff(start,d)+1000;
  let pool=[];

  ALL.forEach(n=>{
   let w=1;
   if(PRIORITY.includes(n)) w=2;
   if(prev.includes(n)) w=0;
   for(let i=0;i<w;i++) pool.push(n);
  });

  if(pool.length<8) pool=[...ALL];

  let set=new Set(); let i=0;
  while(set.size<8){
   set.add(pool[Math.floor(rand(seed+i)*pool.length)]);
   i++;
  }

  let pr=[...set].filter(n=>PRIORITY.includes(n));
  if(pr.length>2){
   set=new Set([...set].filter(n=>!PRIORITY.includes(n)));
   while(set.size<8){
    const n=ALL[Math.floor(rand(seed+200+i)*ALL.length)];
    if(!PRIORITY.includes(n)) set.add(n);
    i++;
   }
  }

  result=[...set];
  prev=result;
 }

 return result;
}

/* ---------- UPDATE ---------- */
function update(){
 const now=nowTallinn();
 clock.innerText=now.toLocaleDateString("et-EE")+" "+now.toLocaleTimeString("et-EE");

 const {total,done,left,today}=calcDays();

 totalDays.value="Kogu periood: "+total+" pÃ¤eva";
 doneDays.value="Tehtud: "+done+" pÃ¤eva";
 leftDays.value="JÃ¤Ã¤nud: "+left+" pÃ¤eva";

 const pct=Math.min(100,(done/total*100).toFixed(1));
 progressBar.style.width=pct+"%";
 progressBar.innerText=pct+"%";

 const g50=Math.round(total*0.5);
 const g75=Math.round(total*0.75);
 goal.value=
 done<g50?`50%: ${g50-done} pÃ¤eva`:
 done<g75?`75%: ${g75-done} pÃ¤eva`:
 done<total?`100%: ${total-done} pÃ¤eva`:"VALMIS";

 todayDate.innerText=today.toLocaleDateString("et-EE");
 todayRight.innerText=roomDuty(today,RIGHT);
 todayLeft.innerText=roomDuty(today,LEFT);

 areaCleaners.innerText=areaCleanersFor(today).join(", ");
}

update();
setInterval(update,1000);
</script>
</body>
</html>
