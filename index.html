<!DOCTYPE html>
<html lang="et">
<head>
<meta charset="UTF-8">
<title>Oktoobri Kutse</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
body{background:#f4f6f8;}
.progress-bar{
 color:#fff;font-weight:bold;
 text-shadow:-1px -1px 0 #000,1px -1px 0 #000,-1px 1px 0 #000,1px 1px 0 #000;
}
</style>
</head>

<body>
<div class="container py-4">

<div class="card shadow text-center mb-3">
<div class="card-body">
<h4>ðŸ‡ªðŸ‡ª Oktoobri Kutse â†’ <strong>PÃ¤evi reservini</strong></h4>
<p id="clock" class="fw-bold"></p>
</div>
</div>

<ul class="nav nav-tabs mb-3">
<li class="nav-item"><button class="nav-link active" data-bs-toggle="tab" data-bs-target="#progressTab">ðŸ“ˆ Edenemine</button></li>
<li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#todayTab">ðŸ§¹ TÃ¤na</button></li>
</ul>

<div class="tab-content">

<div class="tab-pane fade show active" id="progressTab">
<div class="card shadow">
<div class="card-body">

<input id="totalDays" class="form-control mb-2" readonly>
<input id="doneDays" class="form-control mb-2" readonly>
<input id="leftDays" class="form-control mb-2" readonly>

<div class="progress mb-3" style="height:30px">
<div id="progressBar" class="progress-bar progress-bar-striped progress-bar-animated">0%</div>
</div>

<input id="goal" class="form-control" readonly>

</div>
</div>
</div>

<div class="tab-pane fade" id="todayTab">

<div class="card shadow text-center mb-3">
<div class="card-body">
<h5>ðŸ§¹ TÃ¤nased korrapidajad</h5>
<p id="todayDate" class="fw-bold"></p>
<p>Parem tuba: <span id="todayRight"></span></p>
<p>Vasak tuba: <span id="todayLeft"></span></p>
</div>
</div>

<div class="card shadow text-center">
<div class="card-body">
<h5>ðŸ§½ Ala koristajad tÃ¤na</h5>
<p id="areaCleaners" class="fw-bold"></p>
</div>
</div>

</div>
</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
/* ---------------- KUUPÃ„EVAD ---------------- */
const START=new Date(2025,9,13);
const END=new Date(2026,5,12);
const DUTY=new Date(2026,0,6);
const DAY=86400000;

/* ---------------- NIMED ---------------- */
const R=["KOSEMAA","KUUSEORG","LUMISTE","MÃœÃœR","PAASKIVI","PEETRIS","PINT","TAMME","JAKOBSON"];
const L=["SUDER","PISNENKO","TAMMUS","KASPAR PLANS","VIISPERT","NURMETALO","KAAREL PLANS","MARK","KRISTI"];
const ALL=[...R,...L];

/* ---- PEIDETUD PRIORITEET ---- */
function h(n){
 let s=0;
 for(let i=0;i<n.length;i++) s+=n.charCodeAt(i)*(i+5);
 return s%11===7 && n.length%2===0;
}

/* ---------------- ABI ---------------- */
function tallinnNow(){
 return new Date(new Date().toLocaleString("en-US",{timeZone:"Europe/Tallinn"}));
}
function day(d){return new Date(d.getFullYear(),d.getMonth(),d.getDate());}
function diff(a,b){return Math.floor((b-a)/DAY);}

function seeded(x){
 let v=Math.sin(x)*10000;
 return v-Math.floor(v);
}

/* ---------------- PÃ„EVAD ---------------- */
function calc(){
 const today=day(tallinnNow());
 const total=diff(day(START),day(END))+1;
 const done=Math.max(0,diff(day(START),today));
 const left=Math.max(0,diff(today,day(END))+1);
 return {today,total,done,left};
}

/* ---------------- KORRAPIDAJA ---------------- */
function duty(list,today){
 const i=diff(day(DUTY),today);
 return list[(i%list.length+list.length)%list.length];
}

/* ---------------- ALA KORISTAJAD ---------------- */
function cleaners(today){
 const start=day(START);
 let prev=[],res=[];

 for(let d=new Date(start);d<=today;d.setDate(d.getDate()+1)){
  const seed=diff(start,d)+555;
  let pool=[];

  ALL.forEach(n=>{
   let w=1;
   if(h(n)) w=2;
   if(prev.includes(n)) w=0;
   for(let i=0;i<w;i++) pool.push(n);
  });

  if(pool.length<8) pool=[...ALL];

  let set=new Set(),i=0;
  while(set.size<8){
   set.add(pool[Math.floor(seeded(seed+i)*pool.length)]);
   i++;
  }

  let pr=[...set].filter(h);
  if(pr.length>2){
   set=new Set([...set].filter(n=>!h(n)));
   while(set.size<8){
    const n=ALL[Math.floor(seeded(seed+200+i)*ALL.length)];
    if(!h(n)) set.add(n);
    i++;
   }
  }

  res=[...set];
  prev=res;
 }
 return res;
}

/* ---------------- UPDATE ---------------- */
function update(){
 const now=tallinnNow();
 clock.innerText=now.toLocaleDateString("et-EE")+" "+now.toLocaleTimeString("et-EE");

 const {today,total,done,left}=calc();

 totalDays.value="Kogu periood: "+total+" pÃ¤eva";
 doneDays.value="Tehtud: "+done+" pÃ¤eva";
 leftDays.value="JÃ¤Ã¤nud: "+left+" pÃ¤eva";

 const pct=Math.min(100,(done/total*100).toFixed(1));
 progressBar.style.width=pct+"%";
 progressBar.innerText=pct+"%";

 const g50=Math.round(total*0.5);
 const g75=Math.round(total*0.75);
 goal.value=
 done<g50?`50%: ${g50-done} pÃ¤eva`:
 done<g75?`75%: ${g75-done} pÃ¤eva`:
 done<total?`100%: ${total-done} pÃ¤eva`:"VALMIS";

 todayDate.innerText=today.toLocaleDateString("et-EE");
 todayRight.innerText=duty(R,today);
 todayLeft.innerText=duty(L,today);

 areaCleaners.innerText=cleaners(today).join(", ");
}

update();
setInterval(update,1000);
</script>
</body>
</html>
