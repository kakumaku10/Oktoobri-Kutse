<!DOCTYPE html>
<html lang="et">
<head>
<meta charset="UTF-8">
<title>Oktoobri Kutse</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
body{ background:#f8f9fa; }
.progress-bar{ color:#fff; font-weight:bold; }
</style>
</head>
<body>

<div class="container py-4">

<div class="card shadow text-center mb-3">
<div class="card-body">
<h4>ðŸ‡ªðŸ‡ª Oktoobri Kutse â†’ <strong>PÃ¤evi reservini</strong></h4>
<p id="clock" class="fw-bold"></p>
</div>
</div>

<ul class="nav nav-tabs mb-3">
<li class="nav-item">
<button class="nav-link active" data-bs-toggle="tab" data-bs-target="#progressTab">ðŸ“ˆ Edenemine</button>
</li>
<li class="nav-item">
<button class="nav-link" data-bs-toggle="tab" data-bs-target="#todayTab">ðŸ§¹ TÃ¤na</button>
</li>
<li class="nav-item">
<button class="nav-link" data-bs-toggle="tab" data-bs-target="#calendarTab">ðŸ“… Korrapidaja kalender</button>
</li>
</ul>

<div class="tab-content">

<!-- EDENEMINE -->
<div class="tab-pane fade show active" id="progressTab">
<div class="card shadow">
<div class="card-body">

<label>Kogu periood</label>
<input id="totalDays" class="form-control mb-2" readonly>

<label>Tehtud</label>
<input id="doneDays" class="form-control mb-2" readonly>

<label>JÃ¤Ã¤nud</label>
<input id="leftDays" class="form-control mb-2" readonly>

<div class="progress mb-3" style="height:30px">
<div id="progressBar" class="progress-bar progress-bar-striped progress-bar-animated">0%</div>
</div>

<label>JÃ¤rgmine eesmÃ¤rk</label>
<input id="goal" class="form-control" readonly>

</div>
</div>
</div>

<!-- TÃ„NA -->
<div class="tab-pane fade" id="todayTab">
<div class="card shadow text-center">
<div class="card-body">

<h5>ðŸ§¹ TÃ¤nased korrapidajad</h5>
<p id="todayDate" class="fw-bold"></p>

<p><strong>Parem tuba:</strong> <span id="todayRight"></span></p>
<p><strong>Vasak tuba:</strong> <span id="todayLeft"></span></p>

<hr>

<h6>ðŸª– Ala koristajad (8)</h6>
<ul id="randomList" class="list-group mt-2"></ul>

</div>
</div>
</div>

<!-- KALENDER -->
<div class="tab-pane fade" id="calendarTab">
<div class="card shadow">
<div class="card-body">
<div style="max-height:400px; overflow-y:auto;">
<table class="table table-bordered table-striped">
<thead>
<tr>
<th>KuupÃ¤ev</th>
<th>Parem</th>
<th>Vasak</th>
</tr>
</thead>
<tbody id="calendarBody"></tbody>
</table>
</div>
</div>
</div>
</div>

</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>

/* KUUPÃ„EVAD */
const START_DATE = new Date(2025,9,13);
const END_DATE   = new Date(2026,5,12);
const DUTY_START = new Date(2026,0,6);
const DUTY_END   = new Date(2026,5,12);

/* VAHETATUD TOAD */
const ROOMS = {
  parem: ["ARU","SUDER","PISNENKO","TAMMUS","KASPAR PLANS","VIISPERT","NURMETALO","KAAREL PLANS","MARK","KRISTI"],
  vasak: ["KOSEMAA","KUUSEORG","LUMISTE","MÃœÃœR","PAASKIVI","PEETRIS","PINT","TAMME","JAKOBSON"]
};

const DAY_MS = 1000*60*60*24;

function nowTallinn(){
  return new Date(new Date().toLocaleString("en-US",{timeZone:"Europe/Tallinn"}));
}
function dayOnly(d){
  return new Date(d.getFullYear(), d.getMonth(), d.getDate());
}
function daysBetween(a,b){
  return Math.floor((b - a) / DAY_MS);
}

/* UPDATE */
function update(){

  const now = nowTallinn();
  const today = dayOnly(now);

  clock.innerText = now.toLocaleDateString("et-EE")+" "+now.toLocaleTimeString("et-EE");

  const start = dayOnly(START_DATE);
  const end   = dayOnly(END_DATE);

  const total = daysBetween(start,end) + 1;
  const done  = Math.max(0, daysBetween(start,today));
  const left  = Math.max(0, daysBetween(today,end) + 1);

  totalDays.value = total+" pÃ¤eva";
  doneDays.value  = done+" pÃ¤eva";
  leftDays.value  = left+" pÃ¤eva";

  const pct = Math.min(100,(done/total*100).toFixed(1));
  progressBar.style.width = pct+"%";
  progressBar.innerText = pct+"%";

  const g50 = Math.round(total*0.5);
  const g75 = Math.round(total*0.75);

  goal.value =
    done < g50 ? `50%: ${g50-done} pÃ¤eva` :
    done < g75 ? `75%: ${g75-done} pÃ¤eva` :
    done < total ? `100%: ${total-done} pÃ¤eva` :
    "VALMIS";

  const dutyIndex = daysBetween(dayOnly(DUTY_START), today);

  todayDate.innerText = today.toLocaleDateString("et-EE");
  todayRight.innerText = ROOMS.parem[Math.abs(dutyIndex) % ROOMS.parem.length];
  todayLeft.innerText  = ROOMS.vasak[Math.abs(dutyIndex) % ROOMS.vasak.length];

  generateDailyArea(today);
}

/* ALA KORISTAJAD â€“ EI SAA 2 PÃ„EVA JÃ„RJEST */
function generateDailyArea(today){

  const seed = daysBetween(new Date(2025,0,1), today);

  function mulberry32(a){
    return function(){
      var t = a += 0x6D2B79F5;
      t = Math.imul(t ^ t >>> 15, t | 1);
      t ^= t + Math.imul(t ^ t >>> 7, t | 61);
      return ((t ^ t >>> 14) >>> 0) / 4294967296;
    }
  }

  const rngToday = mulberry32(seed);
  const rngYesterday = mulberry32(seed-1);

  function pick(names,rng){
    let copy=[...names];
    let arr=[];
    for(let i=0;i<4;i++){
      const index=Math.floor(rng()*copy.length);
      arr.push(copy[index]);
      copy.splice(index,1);
    }
    return arr;
  }

  const todayRight = pick(ROOMS.parem,rngToday);
  const todayLeft  = pick(ROOMS.vasak,rngToday);

  const yRight = pick(ROOMS.parem,rngYesterday);
  const yLeft  = pick(ROOMS.vasak,rngYesterday);

  let finalRight = todayRight.filter(n=>!yRight.includes(n));
  let finalLeft  = todayLeft.filter(n=>!yLeft.includes(n));

  while(finalRight.length<4){
    const n = ROOMS.parem[Math.floor(rngToday()*ROOMS.parem.length)];
    if(!finalRight.includes(n) && !yRight.includes(n)) finalRight.push(n);
  }
  while(finalLeft.length<4){
    const n = ROOMS.vasak[Math.floor(rngToday()*ROOMS.vasak.length)];
    if(!finalLeft.includes(n) && !yLeft.includes(n)) finalLeft.push(n);
  }

  randomList.innerHTML="";
  [...finalRight,...finalLeft].forEach(n=>{
    randomList.innerHTML+=`<li class="list-group-item">${n}</li>`;
  });
}

/* KALENDER KUNI 12 JUUNI */
function buildCalendar(){

  let html="";
  let i=0;

  for(let d=new Date(DUTY_START); d<=DUTY_END; d.setDate(d.getDate()+1)){

    html+=`
    <tr>
      <td>${d.toLocaleDateString("et-EE")}</td>
      <td>${ROOMS.parem[i % ROOMS.parem.length]}</td>
      <td>${ROOMS.vasak[i % ROOMS.vasak.length]}</td>
    </tr>
    `;

    i++;
  }

  calendarBody.innerHTML=html;
}

buildCalendar();
update();
setInterval(update,1000);

</script>
</body>
</html>
