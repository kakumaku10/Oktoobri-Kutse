<!DOCTYPE html>
<html lang="et">
<head>
<meta charset="UTF-8">
<title>Oktoobri Kutse</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
body{background:#f4f6f8;}
.progress-bar{color:#fff;font-weight:bold;text-shadow:-1px -1px 0 #000,1px -1px 0 #000,-1px 1px 0 #000,1px 1px 0 #000;}
table th, table td{text-align:center;font-size:14px;}
.card{background:#fff;color:#000;}
.nav-tabs .nav-link{color:#000;}
</style>
</head>
<body>
<div class="container py-4">

<div class="card shadow text-center mb-3">
<div class="card-body">
<h4>ðŸ‡ªðŸ‡ª Oktoobri Kutse â†’ <strong>PÃ¤evi reservini</strong></h4>
<p id="clock" class="fw-bold"></p>
</div>
</div>

<ul class="nav nav-tabs mb-3">
<li class="nav-item"><button class="nav-link active" data-bs-toggle="tab" data-bs-target="#progressTab">ðŸ“ˆ Edenemine</button></li>
<li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#todayTab">ðŸ§¹ TÃ¤nased korrapidajad</button></li>
<li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#listTab">ðŸ‘¥ Toa nimekirjad</button></li>
<li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#areaTab">ðŸ§½ Ala koristajad</button></li>
</ul>

<div class="tab-content">

<!-- EDENEMINE -->
<div class="tab-pane fade show active" id="progressTab">
<div class="card shadow">
<div class="card-body">
<label>Kogu periood</label>
<input id="totalDays" class="form-control mb-2" readonly>
<label>Tehtud</label>
<input id="doneDays" class="form-control mb-2" readonly>
<label>JÃ¤Ã¤nud</label>
<input id="leftDays" class="form-control mb-2" readonly>
<label>Progress</label>
<div class="progress mb-3" style="height:30px">
<div id="progressBar" class="progress-bar progress-bar-striped progress-bar-animated">0%</div>
</div>
<label>JÃ¤rgmine eesmÃ¤rk</label>
<input id="goal" class="form-control" readonly>
</div>
</div>
</div>

<!-- TÃ„NA -->
<div class="tab-pane fade" id="todayTab">
<div class="card shadow text-center">
<div class="card-body">
<h5>ðŸ§¹ TÃ¤nased korrapidajad</h5>
<p id="todayDate" class="fw-bold"></p>
<p><strong>Vasak tuba:</strong> <span id="leftToday"></span></p>
<p><strong>Parem tuba:</strong> <span id="rightToday"></span></p>
</div>
</div>
</div>

<!-- TOA LIST -->
<div class="tab-pane fade" id="listTab">
<div class="card shadow mb-4">
<div class="card-body">
<h5 class="text-center mb-4">ðŸ“‹ Toa korrapidaja list</h5>
<div class="row">
<div class="col-md-6">
<h6 class="text-center">Vasak tuba</h6>
<div id="excelLeft"></div>
</div>
<div class="col-md-6">
<h6 class="text-center">Parem tuba</h6>
<div id="excelRight"></div>
</div>
</div>
</div>
</div>
</div>

<!-- ALA KORISTAJAD -->
<div class="tab-pane fade" id="areaTab">
<div class="card shadow text-center">
<div class="card-body">
<h5>ðŸ§½ Ala koristajad tÃ¤na</h5>
<p id="areaCleaners" class="fw-bold"></p>
</div>
</div>
</div>

</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
const START_DATE = new Date(2025,9,13);
const END_DATE = new Date(2026,5,12);
const DUTY_START = new Date(2026,0,6);
const DAY = 86400000;

const LEFT = ["SUDER","PISNENKO","TAMMUS","KASPAR PLANS","VIISPERT","NURMETALO","KAAREL","MARK","KRISTI","ARU"];
const RIGHT = ["KOSEMAA","KUUSEORG","LUMISTE","MÃœÃœR","PAASKIVI","PEETRIS","PINT","TAMME","JAKOBSON"];
const ALL = [...LEFT,...RIGHT];

// iOS compat
function tallinnNow(){try{return new Date(new Date().toLocaleString("en-US",{timeZone:"Europe/Tallinn"}));}catch(e){return new Date();}}
function day(d){return new Date(d.getFullYear(),d.getMonth(),d.getDate());}
function diff(a,b){return Math.floor((b-a)/DAY);}

function calcDays(){
 const today = day(tallinnNow());
 const total = diff(day(START_DATE), day(END_DATE))+1;
 const done = Math.max(0,diff(day(START_DATE), today));
 const left = Math.max(0,diff(today, day(END_DATE))+1);
 return {today,total,done,left};
}

function duty(list,today){
 const i = diff(day(DUTY_START), today);
 return list[(i%list.length+list.length)%list.length];
}

function areaCleaners(today){
 const seed = diff(day(START_DATE), today)+1;
 let res = [];
 while(res.length<8){
   const n = ALL[Math.floor(Math.sin(seed+res.length)*10000%ALL.length)];
   if(!res.includes(n)) res.push(n);
 }
 return res;
}

function updateAll(){
 const now = tallinnNow();
 clock.innerText = now.toLocaleDateString("et-EE")+" "+now.toLocaleTimeString("et-EE");

 const {today,total,done,left} = calcDays();
 totalDays.value = total+" pÃ¤eva";
 doneDays.value = done+" pÃ¤eva";
 leftDays.value = left+" pÃ¤eva";

 const pct = Math.min(100,(done/total*100).toFixed(1));
 progressBar.style.width = pct+"%";
 progressBar.innerText = pct+"%";

 const g50 = Math.round(total*0.5); const g75 = Math.round(total*0.75);
 goal.value = done<g50?`50%: ${g50-done} pÃ¤eva`:
              done<g75?`75%: ${g75-done} pÃ¤eva`:
              done<total?`100%: ${total-done} pÃ¤eva`:"VALMIS";

 todayDate.innerText = today.toLocaleDateString("et-EE");
 leftToday.innerText = duty(LEFT, today);
 rightToday.innerText = duty(RIGHT, today);
 areaCleaners.innerText = areaCleaners(today).join(", ");
}

// TABELID BATCH RENDER 30 PÃ„EVA KORRAGA
function fillTables(){
 const leftContainer = document.getElementById("excelLeft");
 const rightContainer = document.getElementById("excelRight");
 let d = new Date(DUTY_START);

 while(d <= END_DATE){
   const leftTable = document.createElement("table");
   leftTable.className="table table-bordered table-striped mb-2";
   const rightTable = document.createElement("table");
   rightTable.className="table table-bordered table-striped mb-2";

   leftTable.innerHTML="<thead><tr><th>KuupÃ¤ev</th><th>Nimi</th></tr></thead><tbody></tbody>";
   rightTable.innerHTML="<thead><tr><th>KuupÃ¤ev</th><th>Nimi</th></tr></thead><tbody></tbody>";

   const leftBody = leftTable.querySelector("tbody");
   const rightBody = rightTable.querySelector("tbody");

   for(let i=0;i<30 && d<=END_DATE;i++){
     const idx = diff(DUTY_START,d);
     leftBody.innerHTML += `<tr><td>${d.toLocaleDateString("et-EE")}</td><td>${LEFT[idx%LEFT.length]}</td></tr>`;
     rightBody.innerHTML += `<tr><td>${d.toLocaleDateString("et-EE")}</td><td>${RIGHT[idx%RIGHT.length]}</td></tr>`;
     d.setDate(d.getDate()+1);
   }
   leftContainer.appendChild(leftTable);
   rightContainer.appendChild(rightTable);
 }
}

fillTables();
updateAll();
setInterval(updateAll,60000); // uuendab iga minut
</script>
</body>
</html>
