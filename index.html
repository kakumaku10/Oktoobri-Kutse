<!DOCTYPE html>
<html lang="et">
<head>
<meta charset="UTF-8">
<title>Oktoobri Kutse</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
body{
  background:#f8f9fa;
}
.progress-bar{
  color:#fff;
  font-weight:bold;
}
</style>
</head>

<body>

<div class="container py-4">

<!-- PEALKIRI -->
<div class="card shadow text-center mb-3">
<div class="card-body">
<h4>ðŸ‡ªðŸ‡ª Oktoobri Kutse â†’ <strong>PÃ¤evi reservini</strong></h4>
<p id="clock" class="fw-bold"></p>
</div>
</div>

<!-- TABID -->
<ul class="nav nav-tabs mb-3">
<li class="nav-item">
<button class="nav-link active" data-bs-toggle="tab" data-bs-target="#progressTab">ðŸ“ˆ Edenemine</button>
</li>
<li class="nav-item">
<button class="nav-link" data-bs-toggle="tab" data-bs-target="#todayTab">ðŸ§¹ TÃ¤na</button>
</li>
<li class="nav-item">
<button class="nav-link" data-bs-toggle="tab" data-bs-target="#listTab">ðŸ“‹ Toa korrapidaja list</button>
</li>
</ul>

<div class="tab-content">

<!-- EDENEMINE -->
<div class="tab-pane fade show active" id="progressTab">
<div class="card shadow mb-4">
<div class="card-body">

<label>Kogu periood</label>
<input id="totalDays" class="form-control mb-2" readonly>

<label>Tehtud</label>
<input id="doneDays" class="form-control mb-2" readonly>

<label>JÃ¤Ã¤nud</label>
<input id="leftDays" class="form-control mb-2" readonly>

<label>Progress</label>
<div class="progress mb-3" style="height:30px">
<div id="progressBar" class="progress-bar progress-bar-striped progress-bar-animated">0%</div>
</div>

<label>JÃ¤rgmine eesmÃ¤rk</label>
<input id="goal" class="form-control" readonly>

</div>
</div>
</div>

<!-- TÃ„NA -->
<div class="tab-pane fade" id="todayTab">
<div class="card shadow text-center">
<div class="card-body">
<h5>ðŸ§¹ TÃ¤nased korrapidajad</h5>
<p id="todayDate" class="fw-bold"></p>

<p><strong>Parem tuba:</strong> <span id="todayRight"></span></p>
<p><strong>Vasak tuba:</strong> <span id="todayLeft"></span></p>

<hr>

<h6>ðŸª– Ala koristajad (8 suvalist)</h6>
<ul id="randomList" class="list-group mt-2"></ul>

</div>
</div>
</div>

<!-- LIST -->
<div class="tab-pane fade" id="listTab">
<div class="card shadow">
<div class="card-body">
<div class="row">

<div class="col-md-6">
<h6>Parema toa nimekiri</h6>
<ul id="rightList" class="list-group"></ul>
</div>

<div class="col-md-6">
<h6>Vasaku toa nimekiri</h6>
<ul id="leftList" class="list-group"></ul>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>

/* KUUPÃ„EVAD */
const START_DATE = new Date(2025,9,13);
const END_DATE   = new Date(2026,5,12);

/* Korrapidaja algus */
const DUTY_START = new Date(2026,0,6);

/* Nimede listid */
const ROOMS = {
  parem: ["KOSEMAA","KUUSEORG","LUMISTE","MÃœÃœR","PAASKIVI","PEETRIS","PINT","TAMME","JAKOBSON"],
  vasak: ["ARU","SUDER","PISNENKO","TAMMUS","KASPAR PLANS","VIISPERT","NURMETALO","KAAREL PLANS","MARK","KRISTI"]
};

const DAY_MS = 1000*60*60*24;

function nowTallinn(){
  return new Date(new Date().toLocaleString("en-US",{timeZone:"Europe/Tallinn"}));
}
function dayOnly(d){
  return new Date(d.getFullYear(), d.getMonth(), d.getDate());
}
function daysBetween(a,b){
  return Math.floor((b - a) / DAY_MS);
}

/* UPDATE */
function update(){

  const now = nowTallinn();
  clock.innerText = now.toLocaleDateString("et-EE")+" "+now.toLocaleTimeString("et-EE");

  const today = dayOnly(now);
  const start = dayOnly(START_DATE);
  const end   = dayOnly(END_DATE);

  const total = daysBetween(start,end) + 1;
  const done  = Math.max(0, daysBetween(start,today));
  const left  = Math.max(0, daysBetween(today,end) + 1);

  totalDays.value = total+" pÃ¤eva";
  doneDays.value  = done+" pÃ¤eva";
  leftDays.value  = left+" pÃ¤eva";   // ðŸ‘‰ praegu peab nÃ¤itama 110

  const pct = Math.min(100,(done/total*100).toFixed(1));
  progressBar.style.width = pct+"%";
  progressBar.innerText = pct+"%";

  const g50 = Math.round(total*0.5);
  const g75 = Math.round(total*0.75);

  goal.value =
    done < g50 ? `50%: ${g50-done} pÃ¤eva` :
    done < g75 ? `75%: ${g75-done} pÃ¤eva` :
    done < total ? `100%: ${total-done} pÃ¤eva` :
    "VALMIS";

  /* TÃ¤nane korrapidaja */
  const dutyIndex = daysBetween(dayOnly(DUTY_START), today);

  todayDate.innerText = today.toLocaleDateString("et-EE");
  todayRight.innerText = ROOMS.parem[Math.abs(dutyIndex) % ROOMS.parem.length];
  todayLeft.innerText  = ROOMS.vasak[Math.abs(dutyIndex) % ROOMS.vasak.length];

  generateDailyRandomList(today);
}

/* 8 SUVALIST */
function generateDailyRandomList(today){

  const seed = today.getFullYear()*10000 + (today.getMonth()+1)*100 + today.getDate();

  function seededRandom(seed){
    let x = Math.sin(seed) * 10000;
    return x - Math.floor(x);
  }

  function pickRandom(arr, count, offset){
    let copy = [...arr];
    let result = [];

    for(let i=0;i<count;i++){
      const index = Math.floor(seededRandom(seed+offset+i) * copy.length);
      result.push(copy[index]);
      copy.splice(index,1);
    }
    return result;
  }

  const right4 = pickRandom(ROOMS.parem,4,10);
  const left4  = pickRandom(ROOMS.vasak,4,50);

  const combined = [...right4,...left4];

  randomList.innerHTML = "";
  combined.forEach(n=>{
    randomList.innerHTML += `<li class="list-group-item">${n}</li>`;
  });
}

/* Ehita nimekirjad */
function buildLists(){
  rightList.innerHTML="";
  leftList.innerHTML="";
  ROOMS.parem.forEach(n=>{
    rightList.innerHTML+=`<li class="list-group-item">${n}</li>`;
  });
  ROOMS.vasak.forEach(n=>{
    leftList.innerHTML+=`<li class="list-group-item">${n}</li>`;
  });
}

buildLists();
update();
setInterval(update,1000);

</script>
</body>
</html>
